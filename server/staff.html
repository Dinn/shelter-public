<!--index.ejs-->
<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>

    <script src="../socket.io/socket.io.js"></script>
  </head>
  <body>
    <textarea rows="20" cols="30" id="chat"></textarea><br />
    <input type="text" id="user" /><input
      type="button"
      value="msg submit"
      onclick="myOnClick()"
    />
  </body>
  <script>
    var socket = io.connect("http://localhost:4000/chat/1/1");
    //첫 안내메세지
    socket.on("basic-chat", function (data) {
      let chat = document.querySelector("#chat");
      chat.append(data.message);
    });
    //학생의 메세지
    socket.on("teen-chat", function (data) {
      let chat = document.querySelector("#chat");
      chat.append(data.message);
    });
    //직원의 메세지가 왔을때 렌더링
    socket.on("staff-chat", function (data) {
      let chat = document.querySelector("#chat");
      chat.append(data.message);
    });
    //스태프가 처음 채팅창에 접속 했을때 이벤트 전송
    function staffLogin() {
      //이 시점에 스태프의 이메일id를 전송해줘야 db에 저장하기 수월할 것 같다.
      socket.emit("staff-login", {});
    }
    //메세지 전송 버튼 이벤트
    function myOnClick() {
      socket.emit("staff-chat", {
        message: document.querySelector("#user").value,
      });
      document.querySelector("#user").value = "";
    }
    staffLogin();
  </script>
</html>
